<#include "/admin/plugins/appointment/date_commons.html" />

<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<legend>#i18n{appointment.myAppointments.name}</legend>
		<#if list_appointments?? && list_appointments?size &gt; 0>
			<table class="table table-striped table-condensed">
				<tr>
					<th>#i18n{appointment.myAppointments.labelAppointmentFormTitle}</th>
					<th>#i18n{appointment.myAppointments.labelDateAppointment}</th>
					<th>#i18n{appointment.myAppointments.labelTime}</th>
					<th>#i18n{appointment.labelStatus}</th>
					<th>#i18n{appointment.actions.label}</th>
				</tr>
				<#list list_appointments as appointment>
					<tr>
						<td>
							${appointment.appointmentForm.title}
						</td>
						<td id='appointment_date_label_${appointment.idAppointment}'>
						</td>
						<td id='appointment_time_label_${appointment.idAppointment}'>
						</td>
						<td>
							<#if appointment.isCancelled>
								<span class="label label-important">
									#i18n{appointment.message.labelStatusRejected}
								</span>									
							<#else>
								<span class="label label-success">
									#i18n{appointment.message.labelStatusValidated}
								</span>						
							</#if>
						</td>
						<td>
							<#if !appointment.isCancelled>
								<a class="btn btn-danger btn-small" title="#i18n{appointment.labelCancelAppointment}" href="jsp/site/Portal.jsp?page=appointment&action=doCancelAppointment&id_form=${appointment.appointmentForm.idForm}&dateAppointment=${appointment.dateAppointment}&refAppointment=${appointment.refAppointment}&fromMyappointments=true">
									<i class="glyphicon glyphicon-remove">&nbsp;</i>
								</a>
							</#if>
						</td>
					</tr>
				</#list>
			</table>
		<#else>
			#i18n{portal.util.labelNoItem}
		</#if>
	</div>
</div>

<script type="text/javascript">
    $(function() {
		<#list appointment_list as appointment >
		    var date = moment('${appointment.dateOfTheAppointment}', '${SERVER_DATE_FORMAT}', true).format('${USER_DATE_FORMAT}');
		    var start = moment('${appointment.startingTime}', '${SERVER_TIME_FORMAT}', true).format('${USER_TIME_FORMAT}');
	        var end = moment('${appointment.endingTime}', '${SERVER_TIME_FORMAT}', true).format('${USER_TIME_FORMAT}');
		    var date_label = date;
		    var time_label = '#i18n{appointment.labelFrom} ' + start  + ' #i18n{appointment.labelTo} ' + end;

			$('#appointment_date_label_${appointment.idAppointment}').text(date_label);
			$('#appointment_time_label_${appointment.idAppointment}').text(time_label);
		</#list>
    });
</script>